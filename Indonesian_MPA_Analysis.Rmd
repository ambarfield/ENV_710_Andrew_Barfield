---
title: "Indonesia_MPA_Analysis"
author: "Sameer, Andrew, Kayla"
date: '2025-03-01'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Setup
```{r}
#Importing libraries for Shiny dashboard and documentation
library(tidyverse)
library(rlang)
library(roxygen2)
library(gridExtra)
library(here)
library(moments)
library(dunn.test)
```

# Load and Clean Data
```{r}
#Load dataset from an RDS file named "optdata.rds"
settlement_data <- read_csv("Settlement_Data_with_updated_demographics.csv")

head(settlement_data)
```

```{r}
#Rename columns
settlement_data <- settlement_data %>%
                  rename(`Household Material Assets` = MAIndex, `Household Marine Tenure` = MTIndex, 
                         `Food Security Index` = FSIndex, `Place_Attachment_Index` = PAIndex,
                          `School Enrollment Rate` = SERate)
head(settlement_data)
```

```{r}
#Round values to 2 decimal place
settlement_data <- settlement_data %>% 
                  mutate(`Household Material Assets` = round(`Household Material Assets`, 2)) %>%
                  mutate(`Household Marine Tenure` = round(`Household Marine Tenure`, 2)) %>%
                  mutate(`Food Security Index` = round(`Food Security Index`, 2)) %>%
                  mutate(`Place_Attachment_Index` = round(`Place_Attachment_Index`, 2)) %>%
                  mutate(`School Enrollment Rate` = round(`School Enrollment Rate`, 2)) %>%
                  mutate(`YrResident` = round(`YrResident`, 2)) %>%
                  mutate(`Age`= round(`Age`, 2)) %>%
                  mutate(`Gender` = round(`Gender`, 2))
#Look at summary
summary(settlement_data)
```

```{r}
#Remove NAs
settlement_data <- na.omit(settlement_data)
```

# Figure 1
```{r}
# Graph 1
# visualize the distribution of the food security index observations by MPA 
histogram_1 <- ggplot(settlement_data, aes(x = `Food Security Index`,
                                           fill = MPAName)) +
  geom_histogram(bins = 6, binwidth = 0.5) +  # follow rice's rule to get 6ish
  labs(x = "Food Security Index", 
       y = "Count") +
  facet_wrap(~MPAName, nrow = 2)+
  theme_bw() +
  theme(legend.position = "none") 

# view histogram 
histogram_1

# save histogram to files 
ggsave("BarfieldAEmersonKSwarupSFig1.jpg", plot = histogram_1)

```

# Figure 2
```{r, fig.cap="A series of histograms depicting the relationship between food security and place attachment within specific marine protected area (MPA) regions in Indonesia. Both indices are scaled 1-5."}
# Graph 2
# A scatterplot depicting the relationship between the food security 
# and place attachment indices
fs_pa_scatterplot <- ggplot(settlement_data, aes(x = `Food Security Index`,
                            y = `Place_Attachment_Index`)) +
  geom_point(aes(colour = MPAName)) +
  geom_smooth(method = "lm", color = "black") +
  facet_grid(~MPAName) +
  labs(x = "Food Security Index",
       y = "Place Attachment Index",
       color = "MPA Name") +
  ggtitle("Relationship Between Food Security and Place Attachment in Indonesia") +
  theme_bw() +
  theme(legend.position = "bottom",
        legend.background = element_rect(color = "black"))

# View scatterplot
fs_pa_scatterplot

# save scatterplot to files 
ggsave("BarfieldAEmersonKSwarupSFig2.jpg", plot = fs_pa_scatterplot )
```

# Andrew Linear Regression Model
```{r}
# Define Research Question:
# Is there a relationship between place attachment index and gender, 
# age, and years of residency in Indonesian households?

# Examine data and possible correlations
# Raw Counts
ggplot(data = settlement_data, aes(x = `Place_Attachment_Index`)) +
  geom_bar() +
  labs(y = "Count") +
  theme_bw()

ggplot(data = settlement_data, aes(x = Age)) +
  geom_histogram() +
  labs(y = "Count") +
  theme_bw()

ggplot(data = settlement_data, aes(x = Gender)) +
  geom_bar() +
  labs(y = "Count") +
  theme_bw()

ggplot(data = settlement_data, aes(x = YrResident)) +
  geom_histogram() +
  labs(y = "Count") +
  theme_bw()

# Possible Correlations
ggplot(data = settlement_data, aes(x = Age, y = `Place_Attachment_Index`)) +
  geom_point() +
  theme_bw()

ggplot(data = settlement_data, aes(x = Gender, y = `Place_Attachment_Index`)) +
  geom_point() +
  theme_bw()

ggplot(data = settlement_data, aes(x = YrResident, y = `Place_Attachment_Index`)) +
  geom_point() +
  theme_bw()

# Multi-collinearity tests
cor.test(settlement_data$Age, settlement_data$Gender)
cor.test(settlement_data$Age, settlement_data$YrResident)
cor.test(settlement_data$Gender, settlement_data$YrResident)

# Fit regression model
Indonesia_individual_model <- lm(Place_Attachment_Index ~ YrResident +
                                   Age + Gender, data = settlement_data)

summary(Indonesia_individual_model)

# Evaluate Model Diagnostics
plot(Indonesia_individual_model)

# Communicate Results
# The results of our multiple linear regression reveal that age, gender, and
# years of residency are not significant predictors of place attachment in 
# Indonesia (F(410) = 2.195, adjusted R^2 = 0.009, p = 0.09). 

```

# Andrew Kruskal Wallis and Dunn's Test
```{r}
# Null Hypothesis: Place attachment between all MPAs are the same.

# Alternative Hypothesis: Place attachment between at least two 
# MPAs are different. 

# Examining Data Distributions
ggplot(settlement_data, aes(x = Place_Attachment_Index,
                            fill = MPAName)) +
  geom_histogram() +
  facet_grid(.~MPAName) +
  labs(x = "Place Attachment Index",
       y = "Count") +
  theme_bw() +
  theme(legend.position = "bottom")

# Use Q-Q Plots, skewness, and kurtosis to test for normality
ggplot(settlement_data, aes(sample = Place_Attachment_Index)) +
  geom_qq() +
  geom_qq_line() +
  labs (x = "Theoretical Normal Distribution",
        y = "Raw Place Attachment Index Values")

skewness(settlement_data$Place_Attachment_Index)
kurtosis(settlement_data$Place_Attachment_Index)

# Non-normal data, so we will use Kruskal-Wallis and Dunn's post-hoc tests
Indonesia_individual_kruskal_test <- 
  kruskal.test(Place_Attachment_Index ~ MPAName, data = settlement_data)
summary(Indonesia_individual_kruskal_test)

```


```{r}
#Sameer's Logistics Regression Model for determining Place Attachment

#Define a function for Rice's Rule
rice_rule <- function(n) {
  return(2 * (n^(1/3)))
}
```

```{r}
num_bins <- ceiling(rice_rule(length(settlement_data$Place_Attachment_Index)))

#Look at distribution of place attachment values
ggplot(settlement_data, aes(x = Place_Attachment_Index)) +
      geom_histogram(bins = num_bins) +
      labs(x = "Place Attachment", y = "Frequency", title = "Distribution of Place Attachment values amongst Eastern Indonesian communities") +
      theme_bw()

#Distribution is approximately normal with a slight right-skew
```

```{r}
mean_PIA <- mean(settlement_data$Place_Attachment_Index)

#As an initial pass, convert Place_Attachment_Index into a binary categorical variable where values below mean are 0 and values above mean are 1. This categorization can be further explored and tweaked
settlement_data <- settlement_data %>% 
                    mutate(PIA_Binary = ifelse(Place_Attachment_Index > mean_PIA, 1, 0))
```

```{r}
#Data visualizations to examine significance of relation between covariates and response variable

#Examining correlation between response variables
```


```{r}
#Build first logistic regression model with PIA_Binary as response variable
PIA_glm <- glm(PIA_Binary ~ `Household Material Assets` + `Household Marine Tenure` + `Food Security Index` + `School Enrollment Rate`, data = settlement_data)

#As an initial pass, Household Material Assets is a significant predictor (p < 0.05) of PIA_Binary
summary(PIA_glm)
```



# Kayla's Linear Regression Model
```{r}
# Define Research Question:
# Is there a relationship between place attachment index and household material assets, 
# household marine tenure, and school enrollment rate?

# Examine data and possible correlations
# Raw Counts
ggplot(data = settlement_data, aes(x = `Place_Attachment_Index`)) +
  geom_histogram(bins = 15) +
  theme_bw()
# pretty normally distributed 

ggplot(data = settlement_data, aes(x = `Household Material Assets`)) +
  geom_histogram(bins = 15) +
  theme_bw()
# pretty normally distributed 

ggplot(data = settlement_data, aes(x = `Household Marine Tenure`)) +
  geom_histogram(bins = 15) +
  theme_bw()
# not normally distributed

ggplot(data = settlement_data, aes(x = `School Enrollment Rate`)) +
  geom_histogram(bins = 15) +
  theme_bw()
# pretty skewed

# Possible Correlations
ggplot(data = settlement_data, aes(x = `Household Material Assets`, y = `Place_Attachment_Index`)) +
  geom_point() +
  theme_bw()

ggplot(data = settlement_data, aes(x = `Household Marine Tenure`, y = `Place_Attachment_Index`)) +
  geom_point() +
  theme_bw()

ggplot(data = settlement_data, aes(x = `School Enrollment Rate`, y = `Place_Attachment_Index`)) +
  geom_point() +
  theme_bw()

#unclear if any of those have any sort of correlation

# Numerically view correlation 
cor.test(settlement_data$Place_Attachment_Index, settlement_data$`Household Material Assets`)
# very low.... -0.06
cor.test(settlement_data$Place_Attachment_Index, settlement_data$`Household Marine Tenure`)
# slightly better .. 0.158
cor.test(settlement_data$Place_Attachment_Index, settlement_data$`School Enrollment Rate`)
# still low ... -0.135

# Multi-collinearity tests
cor.test(settlement_data$`Household Material Assets`, settlement_data$`Household Marine Tenure`)
# pass
cor.test(settlement_data$`Household Material Assets`, settlement_data$`School Enrollment Rate`)
# pass
cor.test(settlement_data$`Household Marine Tenure`, settlement_data$`School Enrollment Rate`)
# pass 

# ok so no strong correlations, not worried about co-linearity either 
# try to fit model and see what happens 

# Fit regression model
Indonesia_household_model <- lm(Place_Attachment_Index ~ `Household Material Assets` +
                                   `Household Marine Tenure` + `School Enrollment Rate`, 
                                data = settlement_data)

summary(Indonesia_household_model)

# Evaluate Model Diagnostics
plot(Indonesia_household_model)
# plots look fine, no outliers 

# Communicate Results
# The results of our multiple linear regression reveal that household marine tenure, 
# and school enrollment rate are significant predictors of place attachment in 
# Indonesia (F(407) = 5.403, adjusted R^2 = 0.03121, p = 0.0012). 

# household material assets t = 0.496
# household marine tenure t = 0.005 **
# school enrollment rate t  = 0.0378 *


# This model is weak, let's see what it looks like without household material assets
# Fit regression model
Indonesia_household_model2 <- lm(Place_Attachment_Index ~ `Household Marine Tenure`
                                 + `School Enrollment Rate`, 
                                data = settlement_data)

summary(Indonesia_household_model2)

# Evaluate Model Diagnostics
plot(Indonesia_household_model2)
# plots look fine

# The results of our multiple linear regression reveal that household marine tenure, 
# and school enrollment rate are significant predictors of place attachment in 
# Indonesia (F(408) = 7.882, adjusted R^2 = 0.03248, p = 0.0004). 
# household marine tenure t = 0.00468 **
# school enrollment rate t  = 0.0242 *

# better, but not sure what this tells us. maybe we try a multilevel model. 

```